<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Contributing Changes &#8212; Refl1D 0.7.7.post1533+gc6a0ac1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/haiku-site.css?v=ccbba224" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <script src="../_static/documentation_options.js?v=132fb2fb"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="License" href="license.html" />
    <link rel="prev" title="Server installation" href="server.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../index.html">
          <span>Refl1D 0.7.7.post1533+gc6a0ac1 documentation</span></a></h1>
        <h2 class="heading"><span>Contributing Changes</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="server.html">Server installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="license.html">License</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="contributing-changes">
<span id="contributing"></span><h1>Contributing Changes<a class="headerlink" href="#contributing-changes" title="Link to this heading">¶</a></h1>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#simple-patches" id="id1">Simple patches</a></p></li>
<li><p><a class="reference internal" href="#larger-changes" id="id2">Larger changes</a></p>
<ul>
<li><p><a class="reference internal" href="#building-documentation" id="id3">Building Documentation</a></p></li>
<li><p><a class="reference internal" href="#windows-installer" id="id4">Windows Installer</a></p></li>
<li><p><a class="reference internal" href="#os-x-installer" id="id5">OS/X Installer</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#creating-a-new-release" id="id6">Creating a new release</a></p></li>
</ul>
</nav>
<p>The best way to contribute to the reflectometry package is to work
from a copy of the source tree in the revision control system.</p>
<p>The refl1d project is hosted on github at:</p>
<blockquote>
<div><p><a class="reference external" href="https://github.com/reflectometry/refl1d">https://github.com/reflectometry/refl1d</a></p>
</div></blockquote>
<p>You will need the git source control software for your computer.  This can
be downloaded from the <a class="reference external" href="http://www.git-scm.com/">git page</a>, or you can use
an integrated development environment (IDE) such as Eclipse and PyCharm, which
may have git built in.</p>
<section id="simple-patches">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Simple patches</a><a class="headerlink" href="#simple-patches" title="Link to this heading">¶</a></h2>
<p>If you want to make one or two tiny changes, it is easiest to clone the
project, make the changes, document and test, then send a patch.</p>
<p>Clone the project as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">reflectometry</span><span class="o">/</span><span class="n">refl1d</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>You will need bumps and periodictable to run.  If you are fixing bugs in the
scattering length density calculator or the fitting engine, you will want to
clone the repositories as sister directories to the refl1d source tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">bumps</span><span class="o">/</span><span class="n">bumps</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">pkienzle</span><span class="o">/</span><span class="n">periodictable</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>If you are only working with the refl1d modeling code, then you can install
bumps and periodictable using pip:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">periodictable</span> <span class="n">bumps</span>
</pre></div>
</div>
<p>To run the package from the source tree use the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">refl1d</span>
<span class="n">python</span> <span class="n">run</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will first build the package into the build directory then run it.
Any changes you make in the source directory will automatically be used in
the new version.</p>
<p>As you make changes to the package, you can see what you have done using git:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">status</span>
<span class="n">git</span> <span class="n">diff</span>
</pre></div>
</div>
<p>Please update the documentation and add tests for your changes.  We use
doctests on all of our examples that we know our documentation is correct.
More thorough tests are found in test directory.  With the nosetest package,
you can run the tests using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">tests</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>Nose is available on linux form apt-get</p>
<p>When all the tests run, create a patch and send it to <a class="reference external" href="mailto:paul&#46;kienzle&#37;&#52;&#48;nist&#46;gov">paul<span>&#46;</span>kienzle<span>&#64;</span>nist<span>&#46;</span>gov</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="n">patch</span>
</pre></div>
</div>
</section>
<section id="larger-changes">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Larger changes</a><a class="headerlink" href="#larger-changes" title="Link to this heading">¶</a></h2>
<p>For a larger set of changes, you should fork refl1d on github, and issue pull
requests for each part.</p>
<p>Once you have create the fork, the clone line is slightly different:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">YourGithubAccount</span><span class="o">/</span><span class="n">refl1d</span>
</pre></div>
</div>
<p>After you have tested your changes, you will need to push them to your github
fork:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">log</span>
<span class="n">git</span> <span class="n">commit</span> <span class="o">-</span><span class="n">a</span> <span class="o">-</span><span class="n">m</span> <span class="s2">&quot;short sentence describing what the change is for&quot;</span>
<span class="n">git</span> <span class="n">push</span>
</pre></div>
</div>
<p>Good commit messages are a bit of an art.  Ideally you should be able to
read through the commit messages and create a “what’s new” summary without
looking at the actual code.</p>
<p>Make sure your fork is up to date before issuing a pull request.  You can
track updates to the original refl1d package using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">remote</span> <span class="n">add</span> <span class="n">refl1d</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">reflectometry</span><span class="o">/</span><span class="n">refl1d</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="n">refl1d</span>
<span class="n">git</span> <span class="n">merge</span> <span class="n">refl1d</span><span class="o">/</span><span class="n">master</span>
<span class="n">git</span> <span class="n">push</span>
</pre></div>
</div>
<p>When making changes, you need to take care that they work on different
versions of python.   In particular, RHEL6, Centos6.5, Rocks and
ScientificLinux all run python 2.6, most linux/windows/mac users run
python 2.7, but some of the more bleeding edge distributions run 3.3/3.4.
The anaconda distribution makes it convenient to maintain multiple independent
environments
Even better is to test against all python versions 2.6, 2.7, 3.3, 3.4:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pythonX</span><span class="o">.</span><span class="n">Y</span> <span class="n">tests</span><span class="o">.</span><span class="n">py</span>
<span class="n">pythonX</span><span class="o">.</span><span class="n">Y</span> <span class="n">run</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>When all the tests run, issue a pull request from your github account.</p>
<section id="building-documentation">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Building Documentation</a><a class="headerlink" href="#building-documentation" title="Link to this heading">¶</a></h3>
<p>Building the package documentation requires a working Sphinx installation,
and latex to build the pdf. As of this writing we are using sphinx 1.2.</p>
<p>The command line to build the docs is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">cd</span> <span class="n">doc</span> <span class="o">&amp;&amp;</span> <span class="n">make</span> <span class="n">clean</span> <span class="n">html</span> <span class="n">pdf</span><span class="p">)</span>
</pre></div>
</div>
<p>You can see the result by pointing your browser to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">doc</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span>
<span class="n">doc</span><span class="o">/</span><span class="n">_build</span><span class="o">/</span><span class="n">latex</span><span class="o">/</span><span class="n">Refl1d</span><span class="o">.</span><span class="n">pdf</span>
</pre></div>
</div>
<p>Note that this only works with a unix-like environment for now since we are
using <em>make</em>.  On windows, you can run sphinx directly from python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">doc</span>
<span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">sphinx</span><span class="o">.</span><span class="fm">__init__</span> <span class="o">-</span><span class="n">b</span> <span class="n">html</span> <span class="o">-</span><span class="n">d</span> <span class="n">_build</span><span class="o">/</span><span class="n">doctrees</span> <span class="o">.</span> <span class="n">_build</span><span class="o">/</span><span class="n">html</span>
</pre></div>
</div>
<p>ReStructured text format does not have a nice syntax for superscripts and
subscripts.  Units such as g·cm<sup>-3</sup> are entered using macros such as
|g/cm^3| to hide the details.  The complete list of macros is available in</p>
<blockquote>
<div><p>doc/sphinx/rst_prolog</p>
</div></blockquote>
<p>In addition to macros for units, we also define cdot, angstrom and degrees
unicode characters here.  The corresponding latex symbols are defined in
doc/sphinx/conf.py.</p>
<p>There is a bug in older sphinx versions (e.g., 1.0.7) in which latex tables
cannot be created.  You can fix this by changing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">colspec</span><span class="p">)</span>
</pre></div>
</div>
<p>to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">colspec</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</pre></div>
</div>
<p>in site-packages/sphinx/writers/latex.py.</p>
</section>
<section id="windows-installer">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Windows Installer</a><a class="headerlink" href="#windows-installer" title="Link to this heading">¶</a></h3>
<p>You can build the standalone executable using the powershell script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extra</span>\\<span class="n">build_win_installer</span><span class="o">.</span><span class="n">ps1</span>
</pre></div>
</div>
<p>This creates the distribution archive in the dist directory, including
python, the application, the supporting libraries and everything else needed
to run the application.</p>
<p>The installer build script is run automatically on github in response
to a checkin on the master branch via GitHub Actions.</p>
</section>
<section id="os-x-installer">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">OS/X Installer</a><a class="headerlink" href="#os-x-installer" title="Link to this heading">¶</a></h3>
<p>Note: OS/X installer is no longer maintained.</p>
<p>To build a Mac OS/X standalone executable you will need the py2app package.
This should already be available in your mac python environment.</p>
<p>Build the executable using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup_py2app</span>
</pre></div>
</div>
<p>This creates a <em>.dmg</em> file in the <em>dist</em> directory with the Refl1D app
inside.</p>
</section>
</section>
<section id="creating-a-new-release">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Creating a new release</a><a class="headerlink" href="#creating-a-new-release" title="Link to this heading">¶</a></h2>
<p>A developer with maintainer status can tag a new release and publish a package to the <a class="reference external" href="https://pypi.org/project/refl1d/">Python
Package Index (PyPI)</a>. Refl1d uses
<a class="reference external" href="https://versioningit.readthedocs.io/">versioningit</a> to generate the version number
from the latest tag in the git repository.</p>
<ol class="arabic">
<li><p>Update the local copy of the master branch:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># update information from all remotes</span>
<span class="n">git</span> <span class="n">fetch</span> <span class="o">-</span><span class="n">p</span> <span class="o">-</span><span class="n">P</span> <span class="o">-</span><span class="n">t</span> <span class="o">--</span><span class="nb">all</span>
<span class="c1"># update local copy of master</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span>
<span class="n">git</span> <span class="n">rebase</span> <span class="n">origin</span><span class="o">/</span><span class="n">master</span>
<span class="c1"># check the current version number</span>
<span class="n">versioningit</span>
<span class="o">&gt;</span> <span class="mf">0.8.17</span><span class="o">.</span><span class="n">dev805</span>
</pre></div>
</div>
</li>
<li><p>Add release notes and commit to master.</p></li>
</ol>
<p>3. Create the new tag and push it to the remote. Pushing a tag starts the GitHub workflow job to
publish to PyPI (defined in <a class="reference external" href="https://github.com/reflectometry/refl1d/blob/master/.github/workflows/publish.yml">.github/workflows/publish.yml</a>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">tag</span> <span class="n">v1</span><span class="mf">.0.0</span>
<span class="n">versioningit</span>
<span class="o">&gt;</span> <span class="mf">1.0.0</span>
<span class="n">git</span> <span class="n">push</span> <span class="n">origin</span> <span class="o">--</span><span class="n">tags</span> <span class="n">master</span>
</pre></div>
</div>
</section>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="server.html">Server installation</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="license.html">License</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>