<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Magnetism example &#8212; Refl1D 0.7.7.post1533+gc6a0ac1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku-site.css?v=ccbba224" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script src="../../_static/documentation_options.js?v=132fb2fb"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="User’s Guide" href="../../guide/index.html" />
    <link rel="prev" title="Random model" href="../random/model.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>Refl1D 0.7.7.post1533+gc6a0ac1 documentation</span></a></h1>
        <h2 class="heading"><span>Magnetism example</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="../random/model.html">Random model</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../../guide/index.html">User’s Guide</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="magnetism-example">
<h1>Magnetism example<a class="headerlink" href="#magnetism-example" title="Link to this heading">¶</a></h1>
<p>Magnetic structures can be anchored to the layer boundaries.</p>
<p>Defining a magnetic model starts as usual.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">refl1d.names</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>We still need the nuclear structure, so define the materials.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Si</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Si&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">2.0737</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">2.376e-5</span><span class="p">)</span>
<span class="n">Cu</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Cu&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">6.5535</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">8.925e-4</span><span class="p">)</span>
<span class="n">Ta</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ta&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">3.8300</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">3.175e-3</span><span class="p">)</span>
<span class="n">TaOx</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;TaOx&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">1.6325</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">3.175e-3</span><span class="p">)</span>
<span class="n">NiFe</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;NiFe&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">9.1200</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">1.032e-3</span><span class="p">)</span>
<span class="n">CoFe</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;CoFe&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">4.3565</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">7.986e-3</span><span class="p">)</span>  <span class="c1"># 60:40</span>
<span class="n">IrMn</span> <span class="o">=</span> <span class="n">SLD</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;IrMn&quot;</span><span class="p">,</span> <span class="n">rho</span><span class="o">=-</span><span class="mf">0.21646</span><span class="p">,</span> <span class="n">irho</span><span class="o">=</span><span class="mf">4.245e-2</span><span class="p">)</span>
</pre></div>
</div>
<p>The materials are stacked as usual, but the layers with magnetism have
an additional magnetism property specified.  This example use
<a class="reference internal" href="../../refl1d.magnetism.html#refl1d.magnetism.Magnetism" title="refl1d.magnetism.Magnetism"><code class="xref py py-class docutils literal notranslate"><span class="pre">refl1d.magnetism.Magnetism</span></code></a> to define a flat magnetic layer with
the given magnetic scattering length density <em>rhoM</em> and angle <em>thetaM</em>.</p>
<p>The magnetism is anchored to the corresponding nuclear layer, and by
default will have the same thickness and interface.   The magnetic interface
can be shifted relative to the nuclear interface using <em>dead_below</em> and
<em>dead_above</em>.  These can be negative, allowing the magnetism to extend
beyond the nuclear layer.  The magnetic interface can also be varied
independently by using <em>interface_above</em> and <em>interface_below</em> as in the
example below.   Note that interface_below is ignored # in consecutive
layers, much like the nuclear layers, for which the interface attribute
indicates the interface above.  Using <em>extent=2</em>, the single magnetism
definition can extend over two consecutive layers.</p>
<p>The <a class="reference internal" href="../../refl1d.magnetism.html#refl1d.magnetism.MagnetismTwist" title="refl1d.magnetism.MagnetismTwist"><code class="xref py py-class docutils literal notranslate"><span class="pre">refl1d.magnetism.MagnetismTwist</span></code></a> allows you to define a magnetic
layer whose values of theta and rho change linearly throughout the layer.
There are additional magnetism types defined in <code class="xref py py-mod docutils literal notranslate"><span class="pre">reflid.magnetism</span></code>.
Note that the current definition of interface only transitions smoothly
into and out of layers with constant magnetism.  This behaviour may change
in newer releases.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Si</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">2.13</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">Ta</span><span class="p">(</span><span class="mf">38.8</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">NiFe</span><span class="p">(</span><span class="mf">25.0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">magnetism</span><span class="o">=</span><span class="n">Magnetism</span><span class="p">(</span><span class="n">rhoM</span><span class="o">=</span><span class="mf">1.4638</span><span class="p">,</span> <span class="n">thetaM</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">interface_below</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">interface_above</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="o">|</span> <span class="n">CoFe</span><span class="p">(</span><span class="mf">12.7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">magnetism</span><span class="o">=</span><span class="n">Magnetism</span><span class="p">(</span><span class="n">rhoM</span><span class="o">=</span><span class="mf">3.7340</span><span class="p">,</span> <span class="n">thetaM</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">interface_above</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>
    <span class="o">|</span> <span class="n">Cu</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">CoFe</span><span class="p">(</span><span class="mf">30.2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">MagnetismTwist</span><span class="p">(</span><span class="n">rhoM</span><span class="o">=</span><span class="p">[</span><span class="mf">4.5102</span><span class="p">,</span> <span class="mf">1.7860</span><span class="p">],</span> <span class="n">thetaM</span><span class="o">=</span><span class="p">[</span><span class="mi">270</span><span class="p">,</span> <span class="mi">85</span><span class="p">],</span> <span class="n">interface_below</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">interface_above</span><span class="o">=</span><span class="mi">7</span><span class="p">))</span>
    <span class="o">|</span> <span class="n">IrMn</span><span class="p">(</span><span class="mf">4.74</span><span class="p">,</span> <span class="mf">1.7</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">Cu</span><span class="p">(</span><span class="mf">5.148</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">Ta</span><span class="p">(</span><span class="mf">55.4895</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">TaOx</span><span class="p">(</span><span class="mf">47.42</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>
    <span class="o">|</span> <span class="n">air</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Define the fittable parameters as usual, including the magnetism attributes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">rhoM</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">interface_below</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">sample</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">interface_above</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">sample</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">interface_above</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">sample</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">interface_below</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">sample</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">magnetism</span><span class="o">.</span><span class="n">interface_above</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Load the data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">instrument</span> <span class="o">=</span> <span class="n">NCNR</span><span class="o">.</span><span class="n">NG1</span><span class="p">(</span><span class="n">slits_at_Tlo</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">probe</span> <span class="o">=</span> <span class="n">instrument</span><span class="o">.</span><span class="n">load_magnetic</span><span class="p">(</span><span class="s2">&quot;n101Gc1.reflA&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>We are going to compare the calculated reflectivity given two different
step sizes on the profile.  Steps of <em>dz=0.3</em> are good enough for this
example in that finer steps will not significantly change <span class="math notranslate nohighlight">\(\chi^2\)</span>
Steps of <em>dz=2</em> however are significantly different.  You can see the
difference by looking at the spin asymmetry curves for the model rendered
with <em>dz=2</em> and <em>dz=0.3</em> as we do below.  The reflectivity calculation time
scales linearly with the step size, so you may want to use a large step
size for your initial fits and a smaller step size later.  The <em>dA</em> parameter
ought to give the best of both worlds, using a finer step size where the
profile is changing quickly and coarser step size elsewhere, but it is
currently broken and disabled below.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">probe</span><span class="o">=</span><span class="n">probe</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">dA</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">experiment2</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span><span class="n">probe</span><span class="o">=</span><span class="n">probe</span><span class="p">,</span> <span class="n">sample</span><span class="o">=</span><span class="n">sample</span><span class="p">,</span> <span class="n">dz</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dA</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">FitProblem</span><span class="p">([</span><span class="n">experiment</span><span class="p">,</span> <span class="n">experiment2</span><span class="p">])</span>
</pre></div>
</div>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="../random/model.html">Random model</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../../guide/index.html">User’s Guide</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>