<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>MLayer Models &#8212; Refl1D 0.7.7.post1533+gc6a0ac1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/haiku-site.css?v=ccbba224" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css" />
    <script src="../../_static/documentation_options.js?v=132fb2fb"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Four column data" href="../four_column/model.html" />
    <link rel="prev" title="Freeform structures" href="../superlattice/freeform.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="../../index.html">
          <span>Refl1D 0.7.7.post1533+gc6a0ac1 documentation</span></a></h1>
        <h2 class="heading"><span>MLayer Models</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="Top">
      
        <p>
        «&#160;&#160;<a href="../superlattice/freeform.html">Freeform structures</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../four_column/model.html">Four column data</a>&#160;&#160;»
        </p>

      </div>
      <div class="content" role="main">
        
        
  <section id="mlayer-models">
<h1>MLayer Models<a class="headerlink" href="#mlayer-models" title="Link to this heading">¶</a></h1>
<p>This package can load models from other reflectometry fitting software.  In
this example we load an mlayer .staj file and fit the parameters within it.</p>
<p>The staj file can be used directly from the graphical interactor or it can
be previewed from the command line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ refl1d De2_VATR.staj --preview
</pre></div>
</div>
<p>This shows the model plot:</p>
<p>(<a class="reference download internal" download="" href="../../_downloads/949920e79b00b5dfbcab931eb67f8213/readme-1.py"><code class="xref download docutils literal notranslate"><span class="pre">Source</span> <span class="pre">code</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/3480ca288af4214b734e7e65beff1894/readme-1.png"><code class="xref download docutils literal notranslate"><span class="pre">png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/688cbf86868d77d28440b44693306417/readme-1.hires.png"><code class="xref download docutils literal notranslate"><span class="pre">hires.png</span></code></a>, <a class="reference download internal" download="" href="../../_downloads/0058d83d94a66d013a7b3a851d72008f/readme-1.pdf"><code class="xref download docutils literal notranslate"><span class="pre">pdf</span></code></a>)</p>
<figure class="align-default">
<img alt="../../_images/readme-1.png" class="plot-directive" src="../../_images/readme-1.png" />
</figure>
<p>and the available model parameters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">probe</span>
  <span class="o">.</span><span class="n">back_absorption</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;back_absorption&#39;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;background&#39;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">intensity</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;intensity&#39;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">theta_offset</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;theta_offset&#39;</span><span class="p">)</span>
<span class="o">.</span><span class="n">sample</span>
  <span class="o">.</span><span class="n">layers</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">4.24661e-11</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B3 interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">3.00904e-05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B3 irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">5.69228</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B3 rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B3 thickness&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">4.24661e-11</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B2 interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">1.39368e-05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B2 irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">5.86948</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B2 rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">64.0154</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B2 thickness&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">83.7958</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B1 interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">6.93684e-05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B1 irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">0.340309</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B1 rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">316.991</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;B1 thickness&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="mi">3</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">33.2095</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M2 interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">6.93684e-05</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M2 irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">1.73106</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M2 rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">1052.77</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M2 thickness&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">20.6753</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M1 interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">0.00137419</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M1 irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">4.02059</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M1 rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">567.547</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;M1 thickness&#39;</span><span class="p">)</span>
    <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
      <span class="o">.</span><span class="n">interface</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mf">4.24661e-11</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;V interface&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">material</span>
        <span class="o">.</span><span class="n">irho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;V irho&#39;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">rho</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;V rho&#39;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;V thickness&#39;</span><span class="p">)</span>
  <span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">stack</span> <span class="n">thickness</span><span class="p">:</span><span class="mf">2091.32</span>

<span class="p">[</span><span class="n">chisq</span><span class="o">=</span><span class="mf">2.16242</span><span class="p">,</span> <span class="n">nllf</span><span class="o">=</span><span class="mf">408.697</span><span class="p">]</span>
</pre></div>
</div>
<p>Note that the parameters are reversed from the order in mlayer, so layer 0
is the substrate rather than the incident medium.  The graphical interactor,
refl1d_gui, allows you to adjust parameters and fit ranges before starting
the fit, but you can also do so from a script, as shown in
<a class="reference download internal" download="" href="../../_downloads/af65807f69abee5d89c9d91f04203c04/De2_VATR.py"><code class="xref download docutils literal notranslate"><span class="pre">De2_VATR.py</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">refl1d.names</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">refl1d.stajconvert</span> <span class="kn">import</span> <span class="n">load_mlayer</span>

<span class="c1"># Load neutron model and data from staj file</span>
<span class="c1"># Layer names are ordered from substrate to surface, and defaults to</span>
<span class="c1"># the names in the original staj file.</span>
<span class="c1"># Model name defaults to the data file name</span>
<span class="n">layers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;sappire&quot;</span><span class="p">,</span> <span class="s2">&quot;MgO&quot;</span><span class="p">,</span> <span class="s2">&quot;MgHx1&quot;</span><span class="p">,</span> <span class="s2">&quot;MgHx2&quot;</span><span class="p">,</span> <span class="s2">&quot;Pd&quot;</span><span class="p">,</span> <span class="s2">&quot;air&quot;</span><span class="p">]</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">load_mlayer</span><span class="p">(</span><span class="s2">&quot;De2_VATR.staj&quot;</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;n6hd2&quot;</span><span class="p">)</span>

<span class="c1"># Set thickness/roughness fitting parameters to +/- 20 %</span>
<span class="c1"># Set SLD to +/- 5% for all but the incident medium and the substrate.</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="n">M</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">L</span><span class="o">.</span><span class="n">thickness</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">L</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">L</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Let the substrate SLD vary by 2%</span>
<span class="n">M</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">material</span><span class="o">.</span><span class="n">rho</span><span class="o">.</span><span class="n">pmp</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">M</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">M</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">interface</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">FitProblem</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Desorption 2&quot;</span>
</pre></div>
</div>
<p>Staj file constraints are ignored, but you can get similar functionality by
setting parameters to equal expressions of other parameters.  You can even
constrain one staj file to share parameters with another by setting, for
example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">M1</span> <span class="o">=</span> <span class="n">load_mlayer</span><span class="p">(</span><span class="s2">&quot;De1_VATR.staj&quot;</span><span class="p">)</span>
<span class="n">M2</span> <span class="o">=</span> <span class="n">load_mlayer</span><span class="p">(</span><span class="s2">&quot;De2_VATR.staj&quot;</span><span class="p">)</span>
<span class="n">M1</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">thickness</span> <span class="o">=</span> <span class="n">M2</span><span class="o">.</span><span class="n">sample</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">thickness</span>
<span class="n">problem</span> <span class="o">=</span> <span class="n">FitProblem</span><span class="p">([</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">])</span>
</pre></div>
</div>
<p>Dura, J. A. et al. Porous Mg formation upon dehydrogenation of MgH2 thin films. Journal of Applied Physics 109, 093501–093501–7 (2011).</p>
</section>


      </div>
      <div class="bottomnav" role="navigation" aria-label="Bottom">
      
        <p>
        «&#160;&#160;<a href="../superlattice/freeform.html">Freeform structures</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="../four_column/model.html">Four column data</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    </div>
  </body>
</html>